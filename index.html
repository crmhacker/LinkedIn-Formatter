<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CRM Hacker – LinkedIn Text Formatter</title>
  <meta name="description" content="LinkedIn text formatter for CRM Hacker: bold, italic, underline, strikethrough, Unicode fonts, overlays, tiny/sub/sup, title/upper/lowercase, staircase sorting, live LinkedIn preview, recommendations, copy, schedule & post, randomize variants.">
  <style>
    :root{
      --accent:#ff2c2c; --accent-2:#ff5858;
      --bg:#faf9f7; --panel:#ffffff;
      --ink:#222; --muted:#555; --line:#ddd;
      --ok:#18c37d; --warn:#b25b00; --li-blue:#0a66c2;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--accent)}
    .wrap{max-width:1280px;margin:28px auto;padding:0 16px}

    .topbar{display:flex;align-items:center;gap:12px;margin-bottom:14px}
    .topbar img{
      height:54px;width:auto;background:var(--bg);
      border-radius:10px;padding:3px;border:1px solid var(--line);
      box-shadow:0 2px 8px rgba(0,0,0,.06)
    }
    .brand h1{margin:0;font-size:24px}
    .tag{color:var(--muted);font-size:12px}

    .grid{display:grid;grid-template-columns:1.15fr .85fr;gap:16px}
    @media (max-width:1024px){.grid{grid-template-columns:1fr}}

    .card{background:var(--panel);border:1px solid var(--line);border-radius:12px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .pad{padding:14px}
    .divider{height:1px;background:var(--line);margin:12px 0}
    .muted{color:var(--muted);font-size:12px}

    textarea{
      width:100%;min-height:200px;background:#fff;color:var(--ink);
      border:1px solid var(--line);border-radius:10px;padding:12px 14px;font-size:16px;outline:none;resize:vertical
    }

    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:8px}
    .btn{
      background:#f6f6f6;border:1px solid var(--line);color:var(--ink);
      padding:8px 10px;border-radius:10px;font-weight:600;cursor:pointer;font-size:14px
    }
    .btn:hover{background:#eee}
    .btn.primary{background:var(--accent);border-color:var(--accent-2);color:#fff}
    .btn.good{background:var(--ok);border-color:#27da97;color:#fff}
    .btn.link{background:#fff;border:1px dashed var(--line)}

    .toolbar{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
    .chip{
      display:inline-flex;align-items:center;gap:8px;padding:8px 10px;
      border:1px solid var(--line);background:#fafafa;border-radius:10px;cursor:pointer
    }
    .chip input{accent-color:var(--accent)}

    .groupTitle{margin:10px 0 6px;font-size:12px;color:var(--muted)}

    .palette{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:8px}
    .sample{margin-left:auto;opacity:.85;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:55%}

    .recoGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:10px;margin:10px 0}
    .recoCard{background:#fff;border:1px solid var(--line);border-radius:12px;padding:10px}
    .recoHead{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .recoTitle{font-weight:700} .recoDesc{color:var(--muted);font-size:12px}
    .recoText{white-space:pre-wrap;word-break:break-word;background:#fcfcfe;border:1px solid var(--line);border-radius:8px;padding:8px;margin:8px 0;max-height:180px;overflow:auto}
    .recoBtns{display:flex;gap:8px}

    .previewShell{padding:12px}
    .preview{background:#fff;color:#111;border-radius:12px;overflow:hidden;border:1px solid #d2d6de}
    .liTop{display:flex;gap:10px;align-items:flex-start;padding:12px}
    .liTop img{height:40px;width:40px;border-radius:50%;background:#fff}
    .liName{font-weight:600}
    .liMeta{font-size:12px;color:#666}
    .liFollow{margin-left:auto;background:#0a66c2;color:#fff;border:0;border-radius:999px;padding:6px 10px;font-weight:600}
    .liBody{padding:0 12px 12px;white-space:pre-wrap;word-break:break-word}
    .liImage{width:100%;display:none;max-height:380px;object-fit:cover;background:#f5f6f8}
    .liActions{display:flex;gap:18px;border-top:1px solid #eef1f5;padding:10px 12px;color:#5f6b7a;font-size:13px}
    .deviceRow{display:flex;align-items:center;gap:10px;margin:8px 0 0}
    .deviceRow .chip{background:#f6f6f6}

    .meter{height:8px;background:#eee;border-radius:999px;border:1px solid #ddd;overflow:hidden}
    .meter>i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#ff9b73)}

    .toolset{display:none}
    .toolset.active{display:block}

    .schedule{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-top:8px;padding:10px;border:1px dashed var(--line);border-radius:10px;background:#fff}
    .schedule input[type="datetime-local"]{border:1px solid var(--line);border-radius:8px;padding:6px 8px}
    .tz{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <img src="logo.png" alt="CRM Hacker logo" onerror="this.style.display='none'">
      <div class="brand">
        <h1>CRM Hacker — LinkedIn Text Formatter</h1>
        <div class="tag">Built by CRM Hacker</div>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: Editor + recommendations + all controls -->
      <div class="card pad">
        <h3 style="margin-top:0">Editor</h3>

        <!-- Textarea -->
        <textarea id="input" placeholder="Enter your text to format here..."></textarea>

        <!-- Recommendations (beneath textarea) -->
        <div id="recoArea"></div>

        <!-- Primary controls -->
        <div class="controls">
          <button class="btn primary" id="formatBtn">Format → Preview</button>
          <button class="btn" id="recommendBtn">Recommend Formatting</button>
          <button class="btn" id="randomBtn">Randomize</button>
          <button class="btn" id="clearBtn">Clear Formatting</button>
          <span class="muted" id="counts">0 chars • 0 words</span>
        </div>

        <!-- Schedule & Post -->
        <div class="schedule">
          <strong>Schedule & Post</strong>
          <input id="postWhen" type="datetime-local">
          <span class="tz" id="tzInfo"></span>
          <button class="btn" id="postNowBtn">Post / Schedule on LinkedIn</button>
          <button class="btn link" id="icsBtn">Add to Calendar (.ics)</button>
        </div>

        <div class="divider"></div>

        <!-- Toolkit picker -->
        <div class="controls" style="margin-top:0">
          <label class="chip" style="background:#fff">
            <span>Format Toolkit:</span>
            <select id="toolkitPick" style="border:1px solid var(--line);border-radius:8px;padding:6px 8px;background:#fff;margin-left:6px">
              <option value="all" selected>All Tools</option>
              <option value="basic">Basic Styles</option>
              <option value="lists">Lists & Quotes</option>
              <option value="fonts">Fancy Fonts</option>
              <option value="transform">Text Transforms</option>
              <option value="sort">Sorting</option>
              <option value="overlays">Overlays</option>
            </select>
          </label>
        </div>

        <!-- BASIC STYLES -->
        <div class="toolset active" data-set="basic" id="set_basic">
          <div class="groupTitle">Basic Styles (toggle on/off)</div>
          <div class="toolbar">
            <label class="chip"><input type="checkbox" id="stBold"> Bold</label>
            <label class="chip"><input type="checkbox" id="stItalic"> Italic</label>
          </div>
        </div>

        <!-- LISTS & QUOTES -->
        <div class="toolset active" data-set="lists" id="set_lists">
          <div class="groupTitle">Lists & Quotes</div>
          <div class="toolbar">
            <label class="chip"><input type="checkbox" id="stBullets"> Bulleted list</label>
            <label class="chip"><input type="checkbox" id="stNumbers"> Numbered list</label>
            <label class="chip"><input type="checkbox" id="stQuote"> Quote lines</label>
          </div>
        </div>

        <!-- FANCY FONTS -->
        <div class="toolset active" data-set="fonts" id="set_fonts">
          <div class="groupTitle">Fancy fonts (Unicode)</div>
          <div class="palette" id="fontsGrid"></div>
        </div>

        <!-- TEXT TRANSFORMS -->
        <div class="toolset active" data-set="transform" id="set_transform">
          <div class="groupTitle">Text transforms</div>
          <div class="toolbar">
            <label class="chip"><input type="checkbox" id="upper"> UPPER</label>
            <label class="chip"><input type="checkbox" id="lower"> lower</label>
            <label class="chip"><input type="checkbox" id="title"> Title Case</label>
            <label class="chip"><input type="checkbox" id="tiny"> Tiny</label>
            <label class="chip"><input type="checkbox" id="sub"> Sub</label>
            <label class="chip"><input type="checkbox" id="sup"> Sup</label>
            <label class="chip"><input type="checkbox" id="clean"> Remove marks</label>
          </div>
        </div>

        <!-- SORTING -->
        <div class="toolset active" data-set="sort" id="set_sort">
          <div class="groupTitle">Sort / Staircase</div>
          <div class="toolbar">
            <label class="chip"><input type="radio" name="sort" value="none" checked> None</label>
            <label class="chip"><input type="radio" name="sort" value="asc"> Short → Long</label>
            <label class="chip"><input type="radio" name="sort" value="desc"> Long → Short</label>
            <label class="chip"><input type="radio" name="sort" value="stair"> Staircase (S-L-S)</label>
            <span class="muted">Reorders by line length.</span>
          </div>
        </div>

        <!-- OVERLAYS -->
        <div class="toolset active" data-set="overlays" id="set_overlays">
          <div class="groupTitle">Overlays</div>
          <div class="toolbar">
            <label class="chip"><input type="checkbox" id="ovStrike"> Strikethrough</label>
            <label class="chip"><input type="checkbox" id="ovUnder"> Underline</label>
            <label class="chip"><input type="checkbox" id="ovOver"> Overline</label>
            <label class="chip"><input type="checkbox" id="ovSlash"> Slash</label>
            <label class="chip"><input type="checkbox" id="ovWavy"> Wavy</label>
            <label class="chip"><input type="checkbox" id="ovDot"> Dot above</label>
            <label class="chip"><input type="checkbox" id="ovRing"> Ring above</label>
            <label class="chip"><input type="checkbox" id="sentStrike"> Strike per sentence</label>
          </div>
        </div>

        <div class="divider"></div>
        <div class="muted">© CRM Hacker</div>
      </div>

      <!-- RIGHT: LinkedIn preview -->
      <div class="card previewShell">
        <h3 style="margin-top:0">Preview</h3>
        <div class="deviceRow">
          <label class="chip"><input type="radio" name="device" value="desktop" checked> Desktop</label>
          <label class="chip"><input type="radio" name="device" value="mobile"> Mobile</label>
          <div class="chip"><input type="file" id="imagePick" accept="image/*"><span>Attach image</span></div>
          <button class="btn good" id="copyBtn">Copy Output</button>
        </div>
        <div style="height:8px"></div>
        <div class="meter"><i id="meterBar" style="width:0%"></i></div>
        <div class="muted" id="limitInfo" style="margin-top:4px">0 / 3000</div>

        <div id="preview" class="preview" style="margin-top:12px;max-width:760px">
          <div class="liTop">
            <img src="logo.png" alt="CRM Hacker avatar">
            <div>
              <div class="liName">CRM Hacker</div>
              <div class="liMeta">Company • Just now • <span style="color:var(--li-blue)">#CRM #RevOps</span></div>
            </div>
            <button class="liFollow">Follow</button>
          </div>
          <div class="liBody" id="liBody"></div>
          <img id="liImage" class="liImage" alt="attached image" />
          <div class="liActions">
            <span>👍 Like</span><span>💬 Comment</span><span>↗ Share</span><span>•••</span>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ===== Helpers
  const $ = (s,ctx=document)=>ctx.querySelector(s);
  const $$ = (s,ctx=document)=>Array.from(ctx.querySelectorAll(s));
  const input = $('#input'), liBody = $('#liBody');
  const meterBar = $('#meterBar'), limitInfo = $('#limitInfo');
  const LINKEDIN_LIMIT = 3000;

  // Timezone display
  const tzName = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Local';
  $('#tzInfo').textContent = `Timezone: ${tzName}`;

  function updateCounts(){
    const text = input.value;
    const chars = [...text].length;
    const words = text.trim()? text.trim().split(/\s+/).length : 0;
    $('#counts').textContent = `${chars} chars • ${words} words`;
    const pct = Math.min(100, Math.round(chars / LINKEDIN_LIMIT * 100));
    meterBar.style.width = pct + '%';
    limitInfo.textContent = `${chars} / ${LINKEDIN_LIMIT}`;
    limitInfo.style.color = chars>LINKEDIN_LIMIT ? 'var(--warn)' : 'var(--muted)';
  }
  input.addEventListener('input', updateCounts);

  // ===== Unicode maps
  const A='ABCDEFGHIJKLMNOPQRSTUVWXYZ', a='abcdefghijklmnopqrstuvwxyz', D='0123456789';
  const buildMap=(U,L,N)=>{const m=new Map(); if(U!=null)for(let i=0;i<26;i++)m.set(A[i],String.fromCodePoint(U+i)); if(L!=null)for(let i=0;i<26;i++)m.set(a[i],String.fromCodePoint(L+i)); if(N!=null)for(let i=0;i<10;i++)m.set(D[i],String.fromCodePoint(N+i)); return m;};

  const MAPS={
    plain:new Map(),
    bold:buildMap(0x1D400,0x1D41A,0x1D7CE),
    italic:buildMap(0x1D434,0x1D44E,null),
    boldItalic:buildMap(0x1D468,0x1D482,null),
    sans:buildMap(0x1D5A0,0x1D5BA,0x1D7E2),
    sansBold:buildMap(0x1D5D4,0x1D5EE,0x1D7EC),
    mono:buildMap(0x1D670,0x1D68A,0x1D7F6),
    scriptBold:buildMap(0x1D4D0,0x1D4EA,null),
    frakturBold:buildMap(0x1D56C,0x1D586,null),
    doublestruck:buildMap(0x1D538,0x1D552,0x1D7D8),
    fullwidth:buildMap(0xFF21,0xFF41,0xFF10),
    circled:(()=>{const m=new Map();for(let i=0;i<26;i++){m.set(A[i],String.fromCodePoint(0x24B6+i));m.set(a[i],String.fromCodePoint(0x24D0+i));}m.set('0',String.fromCodePoint(0x24EA));for(let i=1;i<=10;i++)m.set(String(i%10),String.fromCodePoint(0x2460+i-1));return m;})(),
    squared:(()=>{const m=new Map();for(let i=0;i<26;i++){m.set(A[i],String.fromCodePoint(0x1F130+i));m.set(a[i],String.fromCodePoint(0x1F130+i));}return m;})(),
    smallcaps:new Map([...a].map((c,i)=>[c,A[i]]))
  };

  // Combining marks + helpers
  const CM={ strike:'\u0336', underline:'\u0332', overline:'\u0305', slash:'\u0337', wavy:'\u0334', dot:'\u0307', ring:'\u030A' };
  const CM_RE=/\p{Mn}+/gu;
  const removeCombining=s=>s.normalize('NFD').replace(CM_RE,'');
  const overlay=(s,marks)=>{const combo=marks.join('');return [...s].map(ch=> (ch===' '||ch==='\n')? ch : ch+combo).join('');}
  const transformWithMap=(s,map)=>[...s].map(ch=> map.get(ch)||ch).join('');
  const toTitle=s=>s.toLowerCase().replace(/\b([a-z])(\w*)/g,(_,h,rest)=>h.toUpperCase()+rest);
  const mapRun=(s,id)=>{const m=MAPS[id]; return m? transformWithMap(s,m) : s;}
  const sentenceStrike=s=>[...s].map(ch=> (ch===' '||ch==='\n')? ch : ch+CM.strike).join('');

  // Tiny/Sub/Sup char maps
  const tinyMap=new Map(Object.entries({a:'ᵃ',b:'ᵇ',c:'ᶜ',d:'ᵈ',e:'ᵉ',f:'ᶠ',g:'ᵍ',h:'ʰ',i:'ᶦ',j:'ʲ',k:'ᵏ',l:'ˡ',m:'ᵐ',n:'ⁿ',o:'ᵒ',p:'ᵖ',q:'ᑫ',r:'ʳ',s:'ˢ',t:'ᵗ',u:'ᵘ',v:'ᵛ',w:'ʷ',x:'ˣ',y:'ʸ',z:'ᶻ',A:'ᴬ',B:'ᴮ',C:'ᶜ',D:'ᴰ',E:'ᴱ',F:'ᶠ',G:'ᴳ',H:'ᴴ',I:'ᴵ',J:'ᴶ',K:'ᴷ',L:'ᴸ',M:'ᴹ',N:'ᴺ',O:'ᴼ',P:'ᴾ',Q:'ᑫ',R:'ᴿ',S:'ˢ',T:'ᵀ',U:'ᵁ',V:'ⱽ',W:'ᵂ',X:'ˣ',Y:'ʸ',Z:'ᶻ',0:'⁰',1:'¹',2:'²',3:'³',4:'⁴',5:'⁵',6:'⁶',7:'⁷',8:'⁸',9:'⁹'}));
  const subMap=new Map(Object.entries({a:'ₐ',e:'ₑ',h:'ₕ',i:'ᵢ',j:'ⱼ',k:'ₖ',l:'ₗ',m:'ₘ',n:'ₙ',o:'ₒ',p:'ₚ',r:'ᵣ',s:'ₛ',t:'ₜ',u:'ᵤ',v:'ᵥ',x:'ₓ',0:'₀',1:'₁',2:'₂',3:'₃',4:'₄',5:'₅',6:'₆',7:'₇',8:'₈',9:'₉'}));
  const supMap=new Map(); 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+-=()'.split('').forEach(ch=>{supMap.set(ch,tinyMap.get(ch)||({'0':'⁰','1':'¹','2':'²','3':'³','4':'⁴','5':'⁵','6':'⁶','7':'⁷','8':'⁸','9':'⁹','+':'⁺','-':'⁻','=':'⁼','(':'⁽',')':'⁾'})[ch]||ch)});

  // REVERSE-FRIENDLY LINE TRANSFORMS
  const stripBullets = s => s.split(/\n/).map(line => line.replace(/^\s*(?:[•\-*]\s+)/,'')).join('\n');
  const applyBullets = s => s.split(/\n/).map(line => line.trim()? '• ' + line.replace(/^\s*(?:[•\-*]\s+)/,'') : '').join('\n');

  const stripNumbers = s => s.split(/\n/).map(line => line.replace(/^\s*\d+\.\s+/,'')).join('\n');
  const applyNumbers = s => {
    let i = 1;
    return s.split(/\n/).map(line => line.trim()? (i++) + '. ' + line.replace(/^\s*\d+\.\s+/,'') : '').join('\n');
  };

  const stripQuotes = s => s.split(/\n/).map(l => l.replace(/^“/,'').replace(/”$/,'')).join('\n');
  const applyQuotes = s => s.split(/\n/).map(l => l? ('“' + stripQuotes(l) + '”') : '').join('\n');

  // MAIN formatter — non-destructive & reversible via toggles
  function runFormat(){
    let s = input.value || '';

    // Case transforms (exclusive)
    if($('#upper').checked) s = s.toUpperCase();
    else if($('#lower').checked) s = s.toLowerCase();
    else if($('#title').checked) s = toTitle(s);

    // Lists & quotes (toggle reversible)
    s = $('#stBullets').checked ? applyBullets(s) : stripBullets(s);
    s = $('#stNumbers').checked ? applyNumbers(s) : stripNumbers(s);
    s = $('#stQuote').checked   ? applyQuotes(s)   : stripQuotes(s);

    // Font map (Unicode)
    const font = (document.querySelector('input[name="font"]:checked')||{}).value;
    if(font) s = mapRun(s, font);

    // Bold/Italic toggles (stackable)
    if($('#stBold').checked)   s = mapRun(s,'bold');
    if($('#stItalic').checked) s = mapRun(s,'italic');

    // Tiny/Sub/Sup (exclusive)
    if($('#tiny').checked) s = transformWithMap(s, tinyMap);
    else if($('#sub').checked) s = transformWithMap(s, subMap);
    else if($('#sup').checked) s = transformWithMap(s, supMap);

    // Overlays
    const marks=[];
    if($('#ovStrike').checked) marks.push(CM.strike);
    if($('#ovUnder').checked)  marks.push(CM.underline);
    if($('#ovOver').checked)   marks.push(CM.overline);
    if($('#ovSlash').checked)  marks.push(CM.slash);
    if($('#ovWavy').checked)   marks.push(CM.wavy);
    if($('#ovDot').checked)    marks.push(CM.dot);
    if($('#ovRing').checked)   marks.push(CM.ring);

    let didSentenceStrike=false;
    if($('#sentStrike').checked){ s = sentenceStrike(s); didSentenceStrike=true; }
    const restMarks = didSentenceStrike ? marks.filter(m=>m!==CM.strike) : marks;
    if(restMarks.length) s = overlay(s, restMarks);

    if($('#clean').checked){
      s = removeCombining(s);
      const restore = (didSentenceStrike? [CM.strike]:[]).concat(restMarks);
      if(restore.length) s = overlay(s, restore);
    }

    liBody.textContent = s;
    updateCounts();
  }

  // ===== Randomize variant generator =====
  function randPick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function coin(p=0.5){ return Math.random()<p; }
  function looksLikeList(s){ return /^\s*[-•\d]/m.test(s) || s.split('\n').filter(x=>x.trim()).length >= 3; }
  function toBullets(s){ return s.split(/\n/).map(l=> l.trim()? '• '+l.replace(/^([•\-\*\d\.]+\s*)/,'') : '').join('\n'); }

  function randomizeFrom(src){
    let s = src || '';
    if(!s.trim()) return s;

    // Optional case
    const caseOps = [null,'upper','lower','title'];
    const chosenCase = randPick(caseOps);
    if(chosenCase==='upper') s = s.toUpperCase();
    else if(chosenCase==='lower') s = s.toLowerCase();
    else if(chosenCase==='title') s = toTitle(s);

    // Maybe list/quote
    if(looksLikeList(s) && coin(.7)){
      s = coin(.6) ? applyNumbers(s) : applyBullets(s);
    }
    if(coin(.3)) s = applyQuotes(s);

    // Font (lightweight random)
    const fontOps = [null,'bold','italic','smallcaps','mono','scriptBold','sans','sansBold'];
    const f = randPick(fontOps);
    if(f) s = mapRun(s,f);

    // Tiny/Sub/Sup (rare)
    const tsOps = [null,'tiny','sub','sup',null,null];
    const ts = randPick(tsOps);
    if(ts==='tiny') s = transformWithMap(s, tinyMap);
    else if(ts==='sub') s = transformWithMap(s, subMap);
    else if(ts==='sup') s = transformWithMap(s, supMap);

    // Overlays subset
    let marks=[];
    if(coin(.25)) marks.push(CM.underline);
    if(coin(.15)) marks.push(CM.strike);
    if(coin(.10)) marks.push(CM.overline);
    if(coin(.10)) marks.push(CM.dot);
    if(coin(.08)) marks.push(CM.ring);
    if(coin(.06)) marks.push(CM.wavy);
    if(coin(.05)) marks.push(CM.slash);
    if(coin(.05)) s = sentenceStrike(s); // per-sentence strike
    if(marks.length) s = overlay(s, marks);

    return s;
  }

  // ===== Recommendations (multi-option grid)
  function recommendVariants(src){
    const variants = [];
    variants.push({ label:'Headline', desc:'Bold + Title Case for hooks', text: mapRun(toTitle(src),'bold') });
    variants.push({ label:'Emphasis', desc:'Italic + Underline', text: overlay(mapRun(src,'italic'),[CM.underline]) });
    variants.push({ label:'Clean', desc:'Small caps—subtle polish', text: mapRun(src,'smallcaps') });
    const perSentence = sentenceStrike(src);
    variants.push({ label:'Callout', desc:'Strike per sentence', text: perSentence });
    if (looksLikeList(src)) variants.push({ label:'List', desc:'Auto-bulleted', text: toBullets(src) });
    else variants.push({ label:'Punchy', desc:'Bold + Strike', text: overlay(mapRun(src,'bold'),[CM.strike]) });
    variants.push({ label:'Subtle', desc:'Title + Underline', text: overlay(toTitle(src),[CM.underline]) });
    variants.push({ label:'Monospace', desc:'Code-style clarity', text: mapRun(src,'mono') });
    variants.push({ label:'Cursive', desc:'Script for taglines', text: mapRun(src,'scriptBold') });
    variants.push({ label:'Double-struck', desc:'Math vibe for emphasis', text: mapRun(src,'doublestruck') });
    return variants;
  }

  function renderRecommendations(list){
    const host = $('#recoArea'); if (!list || !list.length){ host.innerHTML = ''; return; }
    host.innerHTML = `<div class="recoGrid">
      ${list.map((v,i)=>`
        <div class="recoCard">
          <div class="recoHead"><div class="recoTitle">${v.label}</div></div>
          <div class="recoDesc">${v.desc}</div>
          <div class="recoText" id="recoText_${i}">${v.text}</div>
          <div class="recoBtns">
            <button class="btn" data-use="${i}">Use this</button>
            <button class="btn" data-copy="${i}">Copy</button>
          </div>
        </div>`).join('')}
    </div>`;
    host.querySelectorAll('[data-use]').forEach(btn=>{
      btn.addEventListener('click', e=>{
        const idx = +e.currentTarget.dataset.use;
        liBody.textContent = list[idx].text;
      });
    });
    host.querySelectorAll('[data-copy]').forEach(btn=>{
      btn.addEventListener('click', async e=>{
        const idx = +e.currentTarget.dataset.copy;
        await navigator.clipboard.writeText(list[idx].text);
        btn.textContent = 'Copied!';
        setTimeout(()=> btn.textContent='Copy', 900);
      });
    });
  }

  // Build fonts palette (visual)
  const FONT_OPTIONS=[
    ['bold','Bold','Bold text'],
    ['italic','Italic','Italic text'],
    ['boldItalic','Bold Italic','Bold italic'],
    ['sans','Sans','Sans look'],
    ['sansBold','Sans Bold','Sans bold'],
    ['mono','Monospace','Code vibe'],
    ['scriptBold','Cursive','Cursive script'],
    ['frakturBold','Fraktur','Fraktur style'],
    ['doublestruck','Double-struck','Double struck'],
    ['fullwidth','Fullwidth','Ｆｕｌｌｗｉｄｔｈ'],
    ['circled','Circled','Ⓒⓡⓜ'],
    ['squared','Squared','🅲🅁🅼'],
    ['smallcaps','Small Caps','Small Caps']
  ];
  const fontsGrid = $('#fontsGrid');
  FONT_OPTIONS.forEach(([id,label,example])=>{
    const row=document.createElement('label'); row.className='chip'; row.title=label;
    const rb=document.createElement('input'); rb.type='radio'; rb.name='font'; rb.value=id;
    const txt=document.createElement('span'); txt.textContent=label;
    const sample=document.createElement('span'); sample.className='sample'; sample.textContent = mapRun(example, id);
    row.append(rb, txt, sample); fontsGrid.appendChild(row);
  });

  // Image + device
  $('#imagePick').addEventListener('change', (e)=>{
    const f = e.target.files?.[0]; if(!f) return; const url = URL.createObjectURL(f);
    const im = $('#liImage'); im.src=url; im.style.display='block';
  });
  $$('input[name="device"]').forEach(rb=> rb.addEventListener('change',()=>{
    const box=$('#preview'); box.style.maxWidth = rb.value==='mobile'? '420px':'760px';
  }));

  // Wire buttons
  $('#formatBtn').addEventListener('click', runFormat);
  $('#recommendBtn').addEventListener('click', ()=>{
    renderRecommendations(recommendVariants(input.value||''));
    input.scrollIntoView({behavior:'smooth', block:'center'});
  });
  $('#randomBtn').addEventListener('click', ()=>{
    const base = input.value || '';
    if(!base.trim()){ alert('Add some text first.'); return; }
    const v = randomizeFrom(base);
    liBody.textContent = v;
    // also keep counts in sync
    updateCounts();
  });
  $('#clearBtn').addEventListener('click', ()=>{
    input.value='';
    liBody.textContent='';
    // Reset toggles
    ['stBold','stItalic','stBullets','stNumbers','stQuote','upper','lower','title','tiny','sub','sup','clean','ovStrike','ovUnder','ovOver','ovSlash','ovWavy','ovDot','ovRing','sentStrike']
      .forEach(id=>{ const el = document.getElementById(id); if(el) el.checked = false; });
    document.querySelectorAll('input[name="font"]').forEach(el=> el.checked=false);
    document.querySelector('input[name="sort"][value="none"]').checked=true;
    $('#recoArea').innerHTML='';
    updateCounts();
  });
  $('#copyBtn').addEventListener('click', ()=> navigator.clipboard.writeText(liBody.textContent||''));

  // Toolkit picker show/hide logic
  const toolsets = {
    all: ['basic','lists','fonts','transform','sort','overlays'],
    basic: ['basic'],
    lists: ['lists'],
    fonts: ['fonts'],
    transform: ['transform'],
    sort: ['sort'],
    overlays: ['overlays']
  };
  function renderToolkit(value){
    const wanted = new Set(toolsets[value] || toolsets.all);
    $$('.toolset').forEach(div=>{
      const key = div.getAttribute('data-set');
      div.classList.toggle('active', wanted.has(key));
    });
  }
  $('#toolkitPick').addEventListener('change', e=> renderToolkit(e.target.value));
  renderToolkit('all');

  // Live reformat on toggle/radio change
  const liveSelectors = [
    'input[name="sort"]','input[name="font"]',
    '#stBold','#stItalic','#stBullets','#stNumbers','#stQuote',
    '#upper','#lower','#title','#tiny','#sub','#sup','#clean',
    '#ovStrike','#ovUnder','#ovOver','#ovSlash','#ovWavy','#ovDot','#ovRing','#sentStrike'
  ];
  $$(liveSelectors.join(',')).forEach(el=> el.addEventListener('change', runFormat));

  // ====== Schedule & Post ======
  function openLinkedInComposerWithClipboard(){
    const text = liBody.textContent || input.value || '';
    if(!text.trim()){ alert('Write or format something first.'); return; }

    // Try Web Share (mobile/tablet)
    const openComposer = ()=>{
      // Open feed composer; user can click the clock icon to schedule
      window.open('https://www.linkedin.com/feed/?shareActive=true','_blank','noopener');
    };

    if(navigator.share){
      navigator.share({ text })
        .catch(()=>{/* ignore */})
        .finally(()=>{
          navigator.clipboard.writeText(text).finally(()=>{
            openComposer();
            setTimeout(()=>alert('Your text is copied. In the LinkedIn composer, click the “Schedule” (clock) icon to pick date & time.'), 300);
          });
        });
    } else {
      navigator.clipboard.writeText(text).finally(()=>{
        openComposer();
        setTimeout(()=>alert('Your text is copied. In the LinkedIn composer, click the “Schedule” (clock) icon to pick date & time.'), 300);
      });
    }
  }

  function pad(n){return String(n).padStart(2,'0');}
  function toICSDate(dt){
    const y = dt.getUTCFullYear();
    const m = pad(dt.getUTCMonth()+1);
    const d = pad(dt.getUTCDate());
    const hh = pad(dt.getUTCHours());
    const mm = pad(dt.getUTCMinutes());
    const ss = pad(dt.getUTCSeconds());
    return `${y}${m}${d}T${hh}${mm}${ss}Z`;
  }

  function downloadICS(){
    const text = (liBody.textContent || input.value || '').trim();
    if(!text){ alert('Nothing to schedule. Add some text first.'); return; }

    const raw = $('#postWhen').value;
    if(!raw){ alert('Pick a date/time first.'); return; }

    const when = new Date(raw);
    if(isNaN(when.getTime())){ alert('Invalid date/time.'); return; }

    const end = new Date(when.getTime() + 30*60*1000);

    const uid = 'crm-hacker-' + Date.now() + '@formatter';
    const dtstamp = toICSDate(new Date());
    const dtstart = toICSDate(when);
    const dtend = toICSDate(end);

    const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//CRM Hacker//LinkedIn Formatter//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${dtstamp}
DTSTART:${dtstart}
DTEND:${dtend}
SUMMARY:Post on LinkedIn (CRM Hacker)
DESCRIPTION:${text.replace(/\n/g,'\\n').replace(/,/g,'\\,')}
END:VEVENT
END:VCALENDAR`;

    const blob = new Blob([ics], {type:'text/calendar'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'linkedin-post.crmhacker.ics';
    document.body.appendChild(a);
    a.click();
    setTimeout(()=>{ document.body.removeChild(a); URL.revokeObjectURL(url); }, 0);
  }

  $('#postNowBtn').addEventListener('click', openLinkedInComposerWithClipboard);
  $('#icsBtn').addEventListener('click', downloadICS);

  // Init
  updateCounts(); runFormat();
</script>
</body>
</html>
